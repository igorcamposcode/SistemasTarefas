<div class="container mt-4">
  <!-- Título -->
  <h3 class="h3 mb-4">Sistemas de Tarefas - 2024</h3>

  <!-- Botões de Ações -->
  <div class="d-flex justify-content-center gap-3 mb-4">
    <button class="btn btn-primary" (click)="CliqueTarefa()">Nova Tarefa</button>
    <button class="btn btn-secondary" (click)="CliqueMinhaTarefa('minhas-tarefas')">Minhas Tarefas</button>
    <button class="btn btn-danger" (click)="CliqueHome('login')">Sair</button>
  </div>

  <!-- Modal para Cadastro de Tarefas -->
  <div
    class="modal fade"
    id="tarefaModal"
    tabindex="-1"
    aria-labelledby="tarefaModalLabel"
    aria-hidden="true"
    [class.show]="isModalVisible"
    [style.display]="isModalVisible ? 'block' : 'none'"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tarefaModalLabel">{{ tarefaEditando ? 'Editar Tarefa' : 'Nova Tarefa' }}</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="fecharModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="tarefaForm">
            <!-- Nome da Tarefa -->
            <div class="mb-3">
              <label for="titulo" class="form-label">Título</label>
              <input id="titulo" type="text" class="form-control" formControlName="titulo" />
            </div>
            <!-- Descrição -->
            <div class="mb-3">
              <label for="descricao" class="form-label">Descrição</label>
              <textarea id="descricao" class="form-control" formControlName="descricao"></textarea>
            </div>
            <!-- Prioridade -->
            <div class="mb-3">
              <label for="prioridade" class="form-label">Prioridade</label>
              <select id="prioridade" class="form-select" formControlName="prioridade">
                <option *ngFor="let prioridade of prioridades" [value]="prioridade">{{ prioridade }}</option>
              </select>
            </div>
            <!-- Usuário Responsável -->
            <div class="mb-3">
              <label for="usuario" class="form-label">Usuário Responsável</label>
              <input id="usuario" type="text" class="form-control" formControlName="usuario" />
            </div>
            <!-- Datas -->
            <div class="mb-3">
              <label for="dataInicio" class="form-label">Data e Hora de Início</label>
              <input id="dataInicio" type="datetime-local" class="form-control" formControlName="dataInicio" readonly />
            </div>
            <div class="mb-3">
              <label for="dataFim" class="form-label">Data e Hora de Fim</label>
              <input id="dataFim" type="datetime-local" class="form-control" formControlName="dataFim" />
            </div>
            <!-- Documento -->
            <div class="mb-3">
              <label for="documento" class="form-label">Anexar Documento</label>
              <input id="documento" type="file" class="form-control" (change)="onFileSelected($event)" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="salvarTarefa()">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards das Tarefas -->
  <div class="row">
    <div *ngFor="let tarefa of tarefas" class="col-md-4 mb-4">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>{{ tarefa.titulo }}</span>
          <div>
            <button class="btn btn-sm btn-outline-secondary me-2" (click)="editarTarefa(tarefa)">Editar</button>
            <button class="btn btn-sm btn-outline-danger" (click)="excluirTarefa(tarefa.id)">Excluir</button>
          </div>
        </div>
        <div class="card-body">
          <h5 class="card-title">Descrição</h5>
          <p class="card-text">{{ tarefa.descricao }}</p>
          <p><strong>Usuário Responsável:</strong> {{ tarefa.usuario }}</p>
          <p><strong>Início:</strong> {{ tarefa.dataInicio | date: 'short' }}</p>
          <p><strong>Fim:</strong> {{ tarefa.dataFim | date: 'short' }}</p>
          <p><strong>Prioridade:</strong> {{ tarefa.prioridade }}</p>
          <p><strong>Status:</strong> {{ tarefa.estado }}</p>
          <p *ngIf="tarefa.documento">
            <strong>Documento:</strong>
            <a [href]="tarefa.documento.url" target="_blank">{{ tarefa.documento.nome }}</a>
          </p>
          <div class="progress mb-3">
            <div
              class="progress-bar"
              role="progressbar"
              [style.width.%]="calcularProgresso(tarefa)"
              [class.bg-success]="tarefa.estado === 'Concluído'"
              aria-valuenow="calcularProgresso(tarefa)"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              {{ calcularProgresso(tarefa) }}%
            </div>
          </div>
          <button class="btn btn-sm btn-outline-primary" (click)="incluirSubTarefa(tarefa)">+ Adicionar Sub-Tarefa</button>
        </div>
      </div>
    </div>
  </div>
</div>
