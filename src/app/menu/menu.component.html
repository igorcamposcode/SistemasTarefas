<div class="container mt-4">
  <!-- Título -->
  <h3 class="h3 mb-4">Sistemas de Tarefas - 2024</h3>

  <!-- Botões de Ações -->
  <div class="d-flex justify-content-center gap-3 mb-4">
    <button
      class="btn btn-primary"
      (click)="abrirModalUsuario()"
      style="
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande',
          'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      "
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-house-door"
        viewBox="0 0 17 17"
      >
        <path
          d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z"
        />
      </svg>
      Usuário: {{ usuario.nome }}
    </button>
    <button
      class="btn btn-primary"
      (click)="isModalVisible = true"
      style="
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande',
          'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      "
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-file-earmark-plus-fill"
        viewBox="0 0 17 17"
      >
        <path
          d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M8.5 7v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 1 0"
        />
      </svg>
      Nova Tarefa
    </button>
    <button
      class="btn btn-secondary"
      (click)="CliqueMinhaTarefa('minhas-tarefas')"
      style="
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande',
          'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      "
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-list-task"
        viewBox="0 0 17 17"
      >
        <path
          fill-rule="evenodd"
          d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"
        />
        <path
          d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"
        />
        <path
          fill-rule="evenodd"
          d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"
        />
      </svg>
      Minhas Tarefas
    </button>
    <button
      class="btn btn-danger"
      (click)="CliqueHome('login')"
      style="
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande',
          'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      "
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-door-closed"
        viewBox="0 0 17 17"
      >
        <path
          d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3zm1 13h8V2H4z"
        />
        <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0" />
      </svg>
      Sair
    </button>
  </div>

  <!-- Modal para Exibir Dados do Usuário -->
  <div
    class="modal fade"
    id="usuarioModal"
    tabindex="-1"
    aria-labelledby="usuarioModalLabel"
    aria-hidden="true"
    [class.show]="isUsuarioModalVisible"
    [style.display]="isUsuarioModalVisible ? 'block' : 'none'"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="usuarioModalLabel">Dados do Usuário</h5>
          <button
            type="button"
            class="btn-close"
            aria-label="Fechar"
            (click)="fecharModalUsuario()"
          ></button>
        </div>
        <div
          class="modal-body"
          style="
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande',
              'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            font-family: 1rem;
          "
        >
          <p><strong>Nome :</strong> {{ usuario.nome }}</p>
          <p><strong>Telefone :</strong> {{ usuario.telefone }}</p>
          <p><strong>Email :</strong> {{ usuario.email }}</p>
          <button
            class="btn btn-primary mt-3"
            (click)="abrirModalEditarUsuario()"
          >
            Alterar Dados do Usuário
          </button>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="fecharModalUsuario()"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Editar Dados do Usuário -->
  <div
    class="modal fade"
    id="editarUsuarioModal"
    tabindex="-1"
    aria-labelledby="editarUsuarioModalLabel"
    aria-hidden="true"
    [class.show]="isEditarUsuarioModalVisible"
    [style.display]="isEditarUsuarioModalVisible ? 'block' : 'none'"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editarUsuarioModalLabel">
            Alterar Dados do Usuário
          </h5>
          <button
            type="button"
            class="btn-close"
            aria-label="Fechar"
            (click)="fecharModalEditarUsuario()"
          ></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="usuarioForm">
            <!-- Nome -->
            <div class="mb-3">
              <label for="nome" class="form-label">Nome</label>
              <input
                id="nome"
                type="text"
                class="form-control"
                formControlName="nome"
                placeholder="Digite seu nome"
              />
            </div>
            <!-- Telefone -->
            <div class="mb-3">
              <label for="telefone" class="form-label">Telefone</label>
              <input
                id="telefone"
                type="text"
                class="form-control"
                formControlName="telefone"
                placeholder="Digite seu telefone"
              />
            </div>
            <!-- Email -->
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input
                id="email"
                type="email"
                class="form-control"
                formControlName="email"
                placeholder="Digite seu email"
              />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="fecharModalEditarUsuario()"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="salvarDadosUsuario()"
          >
            Salvar Alterações
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Cadastro de Tarefas -->
  <div
    class="modal fade"
    id="tarefaModal"
    tabindex="-1"
    aria-labelledby="tarefaModalLabel"
    aria-hidden="true"
    [class.show]="isModalVisible"
    [style.display]="isModalVisible ? 'block' : 'none'"
    (keydown.esc)="fecharModal()"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tarefaModalLabel">
            {{ tarefaEditando ? "Editar Tarefa" : "Nova Tarefa" }}
          </h5>
          <button
            type="button"
            class="btn-close"
            aria-label="Close"
            (click)="fecharModal()"
          ></button>
        </div>
        <div class="modal-body">
          <form
            [formGroup]="tarefaForm"
            (ngSubmit)="salvarNovaTarefa(tarefaForm.value)"
          >
            <!-- Nome da Tarefa -->
            <div class="mb-3">
              <label for="titulo" class="form-label">Título</label>
              <input
                id="titulo"
                type="text"
                class="form-control"
                formControlName="titulo"
                placeholder="Digite o título da tarefa"
                required
              />
            </div>

            <!-- Descrição -->
            <div class="mb-3">
              <label for="descricao" class="form-label">Descrição</label>
              <textarea
                id="descricao"
                class="form-control"
                formControlName="descricao"
                rows="3"
                placeholder="Digite uma descrição para a tarefa"
                required
              ></textarea>
            </div>

            <!-- Prioridade -->
            <div class="mb-3">
              <label for="prioridade" class="form-label">Prioridade</label>
              <select
                id="prioridade"
                class="form-select"
                formControlName="idprioridade"
                required
              >
                <option value="" disabled selected>
                  Selecione uma prioridade
                </option>
                <option
                  *ngFor="let prioridade of prioridades"
                  [value]="prioridade.id"
                >
                  {{ prioridade.nome }}
                </option>
              </select>
            </div>

            <!-- Estado da Tarefa -->
            <div class="mb-3">
              <label for="estado" class="form-label">Estado</label>
              <select
                id="estado"
                class="form-select"
                formControlName="idestado"
                required
              >
                <option value="" disabled selected>Selecione um estado</option>
                <option *ngFor="let estado of estados" [value]="estado.id">
                  {{ estado.nome }}
                </option>
              </select>
            </div>

            <!-- Usuário Responsável -->
            <div class="mb-3">
              <label for="usuario" class="form-label"
                >Usuário Responsável</label
              >
              <input
                id="usuario"
                type="text"
                class="form-control"
                formControlName="idusuario"
                readonly
                [value]="usuario.nome"
                placeholder="Digite o ID do usuário responsável"
              />
            </div>

            <!-- Datas -->
            <div class="mb-3">
              <label for="dataInicio" class="form-label"
                >Data e Hora de Início</label
              >
              <input
                id="dataInicio"
                type="datetime-local"
                class="form-control"
                formControlName="dthrinicio"
                readonly
              />
            </div>
            <div class="mb-3">
              <label for="dataFim" class="form-label">Data e Hora de Fim</label>
              <input
                id="dataFim"
                type="datetime-local"
                class="form-control"
                formControlName="dthrfim"
              />
            </div>

            <!-- Documento -->
            <div class="mb-3">
              <label for="documento" class="form-label">Anexar Documento</label>
              <input
                id="documento"
                type="file"
                class="form-control"
                (change)="onFileSelected($event)"
              />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="fecharModal()"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="tarefaForm.invalid"
            (click)="salvarTarefa()"
          >
            Salvar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards das Tarefas -->
  <div class="row">
    <div *ngFor="let tarefa of tarefas" class="col-md-4 mb-4">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <span>{{ tarefa.titulo }}</span>
          <div>
            <button
              class="btn btn-sm btn-outline-secondary me-2"
              (click)="editarTarefa(tarefa)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-pencil-square"
                viewBox="0 0 17 17"
              >
                <path
                  d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"
                />
                <path
                  fill-rule="evenodd"
                  d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"
                />
              </svg>
              Editar
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              (click)="excluirTarefa(tarefa.id)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-trash3"
                viewBox="0 0 17 17"
              >
                <path
                  d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"
                />
              </svg>
              Excluir
            </button>
          </div>
        </div>
        <div class="card-body">
          <strong>
            <h3 class="card-title">Descrição</h3>
          </strong>
          <p class="card-text">{{ tarefa.descricao }}</p>
          <p><strong>Usuário Responsável: </strong> {{ tarefa.usuario }}</p>
          <p>
            <strong>Início: </strong>
            {{
              tarefa.dthrinicio
                ? (tarefa.dthrinicio | date : "dd/MM/yyyy HH:mm")
                : "Não definido"
            }}
          </p>
          <p>
            <strong>Fim: </strong>
            {{
              tarefa.dthrfim
                ? (tarefa.dthrfim | date : "dd/MM/yyyy HH:mm")
                : "Não definido"
            }}
          </p>
          <p><strong>Prioridade: </strong> {{ tarefa.prioridade }}</p>
          <p><strong>Status: </strong> {{ tarefa.estado }}</p>
          <p *ngIf="tarefa.documento">
            <strong>Documento:</strong>
            <a [href]="tarefa.documento.url" target="_blank">{{
              tarefa.documento.nome
            }}</a>
          </p>

          <h6>Subtarefas</h6>
          <ul>
            <li *ngFor="let sub of tarefa.subTarefas">
              <input
                type="checkbox"
                [checked]="sub.estado === 'Concluído'"
                (change)="marcarSubTarefaConcluida(sub, tarefa)"
              />
              <span
                [class.text-decoration-line-through]="
                  sub.estado === 'Concluído'
                "
                class="ms-2"
              >
                {{ sub.titulo }} - {{ sub.prioridade }}
              </span>
              <button
                class="btn btn-sm btn-outline-secondary ms-2"
                (click)="editarSubTarefa(sub, tarefa)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-pencil-square"
                  viewBox="0 0 17 17"
                >
                  <path
                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"
                  />
                  <path
                    fill-rule="evenodd"
                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"
                  />
                </svg>
                Editar
              </button>
            </li>
          </ul>
          <div class="progress mb-3">
            <div
              class="progress-bar"
              role="progressbar"
              [style.width.%]="calcularProgresso(tarefa)"
              [class.bg-success]="tarefa.estado === 'Concluído'"
              aria-valuenow="calcularProgresso(tarefa)"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              {{ calcularProgresso(tarefa) }}%
            </div>
          </div>

          <button
            class="btn btn-sm btn-outline-primary me-2"
            (click)="incluirSubTarefa(tarefa)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-file-earmark-plus-fill"
              viewBox="0 0 17 17"
            >
              <path
                d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M8.5 7v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 1 0"
              />
            </svg>
            Adicionar Sub-Tarefa
          </button>

          <!-- Botão para Concluir Tarefa -->
          <button
            *ngIf="tarefa.estado !== 'Concluído'"
            class="btn btn-sm btn-outline-success"
            (click)="concluirTarefa(tarefa.id)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-check-circle"
              viewBox="0 0 17 17"
            >
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"
              />
              <path
                d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"
              />
            </svg>
            Concluir
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
